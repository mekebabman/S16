A simple single-user/volume file system for S16

This file system uses 2048 byte blocks.

Structure:

Block       blocks      ?
0           1           super block 
1           4           block tables
^^^^
    Note: this contains 64 byte tables that contain 32 word-wide block numbers for the files data.

5           1           root directory
^^^^
    This is the only directory.
    All file tables in the root directory should be marked with attribute "in-use" (bit 3) if they are used.

6           N           data

Super block structure:

Wait! What does the super block have?
The super block contains the boot record, meta data, 3 bitmaps to track free/used blocks, block tables, file tables.

Offset      size            ?
0000h       495 bytes       boot record code
01efh       12 bytes        oem in acsii and padded with blanks
01fbh       2 bytes         total blocks reserved (1 - 2048)
01fdh       1 byte          number of heads and sectors per track bitpacked
^^^^
    Number of heads and sectors per track should be bitpacked in this order!

    0 0 0 0 0 0 0 0 Bit 0 (byte)
    --- -----------
    |             | Bits 0 - 5
    |             Sectors per track (0 - 63)
    | Bits 7 - 6
  Heads (0 - 3)

01feh       2 bytes         boot signature                 
0200h       256 bytes       free / used blocks bitmap
^^^^
    Starts at MSB.
    Block numbers should be 1 based.

    You can easily check if a block is free or is being used by doing:
    byte in bitmap = block number >> 3 or just block number / 8
    bit in byte = block number & 7 or just block number % 8

0300h       16 bytes         free / used block tables bitmap
^^^^
    Starts at MSB.
    Block table numbers should be 1 based.

    You can easily check if a block table is free or is being used by doing:
    byte in bitmap = block table number >> 3 or just block table number / 8
    bit in byte = block table number & 7 or just block table number % 8

0310h       16 bytes        free / used file tables in root directory
^^^^
    Starts at MSB.
    File table numbers should be 1 based.

    You can easily check if a file table is free or is being used by doing:
    byte in bitmap = file table number >> 3 or just file table number / 8
    bit in byte = file table number & 7 or just file table number % 8

0320h       1248 bytes      reserved

Block table structure:

Wait! What are block tables?
Block tables are stored in a reserved spot, and contain a bunch of word-wide block numbers that can be used to safely get a files data.

Offset      size            ?
0000h       64 bytes        block numbers[32]
^^^^
    This contains 32 word-wide block numbers that can be used to locate data.
    You can get the absolute starting sector easily by just doing:
    (Block number << 11) >> log2(bytes per sector) or just Block number * 2048 / bytes per sector
    If you assume 512 byte sectors you can simply just do Block number << 2
    If you assume 1024 byte sectors you can also just do Block number << 1
    If you assume 2048 byte sectors then you can just outright use the block number.

File table structure:

Wait! Where are file tables stored?
File tables are stored in the root directory, they contain information to represent a single file.

Offset      size            ?
0000h       12 bytes        file name
000Ch       2 bytes         block table number
^^^^
    If you want to access the files data you need a block table, and this can be used to locate the files block table.
    You can get the byte offset for the block table by simply doing:
    Block table number << 6 or just Block table number * 64

000Eh       1 byte          file attributes
000Fh       1 byte          allocated blocks (1 - 32)

File attributes:

0 0 0 0 0 0 0 0 B (byte)
        | | | |
        | | | ---------- Read-only (bit 0)
        | | ------------ System (bit 1) 
        | -------------- Executable (bit 2)
        ---------------- In-use (bit 3)

Extra notes:

Just to make sure!
You should set the bits 15 - 10 in the "free / used blocks bitmap".
When deleting a file you should unset its block table number, file table number, and block numbers in the bitmaps and then mark with attribute "unused" (bit 3).
When allocating a new file you should read the bitmaps from MSB to LSB until you find a unset block number / block table number / file table number.
You can cache the reserved blocks for the block tables and the root directory in memory to lower disk overhead.

You should probably know these:

Constraint              ?
File size limit         64KiB
Volume size limit       4MB
Max allocatable files   128

Feel free to implement it anyway you want!